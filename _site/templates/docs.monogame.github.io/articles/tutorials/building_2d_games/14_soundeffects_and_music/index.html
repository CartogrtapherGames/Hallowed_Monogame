<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Chapter 14: SoundEffects and Music | hallowed </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Chapter 14: SoundEffects and Music | hallowed ">
      <meta name="generator" content="docfx ">
  
      <link rel="shortcut icon" href="../../../../../../favicon.ico">
      <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/night-owl.min.css">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" integrity="sha384-EvBWSlnoFgZlXJvpzS+MAUEjvN7+gcCwH+qh7GRFOGgZO0PuwOFro7qPOJnLfe7l" crossorigin="anonymous">
      <link rel="stylesheet" href="../../../../../../styles/config.css">
      <link rel="stylesheet" href="../../../../../../styles/singulink.css">
      <link rel="stylesheet" href="../../../../../../styles/main.css">
      <meta property="docfx:navrel" content="../../../../../../toc.html">
      <meta property="docfx:tocrel" content="../../../toc.html">
  
  <meta property="docfx:rel" content="../../../../../../">
  
    </head>
    <body>
        <!-- Header required for docfx anchor scroll to work -->
        <header id="head"></header>
        <div class="top-navbar">
            <a class="burger-icon" onclick="toggleMenu()">
                <svg name="Hamburger" style="vertical-align: middle;" width="34" height="34" viewbox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M20 6H4V9H20V6ZM4 10.999H20V13.999H4V10.999ZM4 15.999H20V18.999H4V15.999Z"></path></svg>
            </a>


            <a class="brand" href="../../../../../../index.html">
              <img src="../../../../../../logo.svg" alt="hallowed" class="logomark">
              <span class="brand-title">hallowed</span>
            </a>        </div>

        <div class="body-content">
            <div id="blackout" class="blackout" onclick="toggleMenu()"></div>

            <nav id="sidebar" role="navigation">
                <div class="sidebar">

                    <div>
                      <div class="mobile-hide">

                        <a class="brand" href="../../../../../../index.html">
                          <img src="../../../../../../logo.svg" alt="hallowed" class="logomark">
                          <span class="brand-title">hallowed</span>
                        </a>                      </div>

                      <div class="sidesearch">
                        <form id="search" role="search" class="search">
                            <i class="bi bi-search search-icon"></i>
                            <input type="text" id="search-query" placeholder="Search" autocomplete="off">
                        </form>
                      </div>

                      <div id="navbar">
                      </div>
                    </div>                    <div class="sidebar-item-separator"></div>

                        <div id="sidetoggle">
                          <div id="sidetoc"></div>
                        </div>
                </div>
                <div class="footer">
  
  <strong><a href='https://dotnet.github.io/docfx/'>DocFX</a> + <a href='https://www.singulink.com'>Singulink</a> = â™¥</strong>
                </div>            </nav>

            <main class="main-panel">

                <div id="search-results" style="display: none;">
                  <h1 class="search-list">Search Results for <span></span></h1>
                  <div class="sr-items">
                    <p><i class="bi bi-hourglass-split index-loading"></i></p>
                  </div>
                  <ul id="pagination" data-first=First data-prev=Previous data-next=Next data-last=Last></ul>
                </div>
 

                <div role="main" class="hide-when-search">

                        <div class="subnav navbar navbar-default">
                          <div class="container hide-when-search" id="breadcrumb">
                            <ul class="breadcrumb">
                              <li></li>
                            </ul>
                          </div>
                        </div>

                         <div class="contribution">
                               <a href="https://github.com/MonoGame/docs.monogame.github.io/blob/main/articles/tutorials/building_2d_games/14_soundeffects_and_music/index.md/#L1" class="contribution-link">Edit this page</a>
                         </div>

                    <article class="content wrap" id="_content" data-uid="">


<p>In <a href="../12_collision_detection/index.html">Chapter 12</a>, we implemented collision detection to enable interactions between game objects; the slime can now &quot;eat&quot; the bat, which respawns in a random location, while the bat bounces off walls of the dungeon. While these mechanics work visually, our game lacks an important element of player feedback: audio.</p>
<p>Audio plays a crucial role in game development by providing immediate feedback for player actions and creating atmosphere. Sound effects alert players when events occur (like collisions or collecting items), while background music helps establish mood and atmosphere.</p>
<p>In this chapter, you will:</p>
<ul>
<li>Learn how MonoGame handles different types of audio content.</li>
<li>Learn how to load and play sound effects and music using the content pipeline.</li>
<li>Implement sound effects for collision events.</li>
<li>Add background music to enhance atmosphere.</li>
</ul>
<p>We will first start by understanding how MonoGame approaches audio content.</p>
<h2 id="understanding-audio-in-monogame">Understanding Audio in MonoGame</h2>
<p>Recall from <a href="../01_what_is_monogame/index.html">Chapter 01</a> that MonoGame is an implementation of the XNA API.  With XNA, there were two methods for implementing audio in your game: the <em>Microsoft Cross-Platform Audio Creation Tool</em> (XACT) and the simplified sound API.</p>
<div class="IMPORTANT">
<h5>Important</h5>
<p>XACT is a mini audio engineering studio where you can easily edit the audio for your game like editing volume, pitch, looping, applying effects, and other properties without having to do it in code. At that time, XACT for XNA games was akin to what FMOD Studio is today for game audio.</p>
<table>
<thead>
<tr>
<th style="text-align: center;"><img src="./images/xact-editor.png" alt="Figure 14-1: Microsoft Cross-Platform Audio Creation Tool"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>Figure 14-1: Microsoft Cross-Platform Audio Creation Tool</strong></td>
</tr>
</tbody>
</table>
<p>While XACT projects are still fully supported in MonoGame, it remains a Windows-only tool that has not been updated since Microsoft discontinued the original XNA, nor has its source code been made open source. Though it is possible to install XACT on modern Windows, the process can be complex.</p>
<p>For these reasons, this tutorial will focus on the simplified sound API, which provides all the core functionality needed for most games while remaining cross-platform compatible.</p>
</div>
<p>The simplified sound API approaches audio management through two distinct paths, each optimized for different use cases in games. When adding audio to your game, you need to consider how different types of sounds should be handled:</p>
<ul>
<li><strong>Sound Effects</strong>: Short audio clips that need to play immediately and often simultaneously, like the bounce of a ball or feedback for picking up a collectable.</li>
<li><strong>Music</strong>: Longer audio pieces that play continuously in the background, like level themes.</li>
</ul>
<p>MonoGame addresses these different needs through two main classes:</p>
<h3 id="sound-effects">Sound Effects</h3>
<p>The <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect"><strong>SoundEffect</strong></a> class handles short audio clips like:</p>
<ul>
<li>Collision sounds.</li>
<li>Player action feedback (jumping, shooting, etc.).</li>
<li>UI interactions (button clicks, menu navigation).</li>
<li>Environmental effects (footsteps, ambient sounds).</li>
</ul>
<p>The key characteristics of sound effects are:</p>
<ul>
<li>Loaded entirely into memory for quick access</li>
<li>Can play multiple instances simultaneously:
<ul>
<li>Mobile platforms can have a maximum of 32 sounds playing simultaneously.</li>
<li>Desktop platforms have a maximum of 256 sounds playing simultaneously.</li>
<li>Consoles and other platforms have their own constraints, and you would need to refer to the SDK documentation for that platform.</li>
</ul>
</li>
<li>Lower latency playback (ideal for immediate feedback)</li>
<li>Individual volume control per instance.</li>
</ul>
<h3 id="music">Music</h3>
<p>The <a href="xref:Microsoft.Xna.Framework.Media.Song"><strong>Song</strong></a> class handles longer audio pieces like background music.  The key characteristics of songs are:</p>
<ul>
<li>Streamed from storage rather than loaded into memory.</li>
<li>Only one song can be played at a time.</li>
<li>Higher latency, but lower memory usage.</li>
</ul>
<p>Throughout this chapter, we will use both classes to add audio feedback to our game; sound effects for the bat bouncing and being eaten by the slime, and background music to create atmosphere.</p>
<h2 id="loading-audio-content">Loading Audio Content</h2>
<p>Just like textures, audio content in MonoGame can be loaded through the content pipeline, optimizing the format for your target platform.</p>
<h3 id="supported-audio-formats">Supported Audio Formats</h3>
<p>MonoGame supports several audio file formats for both sound effects and music:</p>
<ul>
<li><code>.wav</code>: Uncompressed audio, ideal for short sound effects</li>
<li><code>.mp3</code>: Compressed audio, better for music and longer sounds</li>
<li><code>.ogg</code>: Open source compressed format, supported on all platforms</li>
<li><code>.wma</code>: Windows Media Audio format (not recommended for cross-platform games)</li>
</ul>
<div class="TIP">
<h5>Tip</h5>
<p>For sound effects, <code>.wav</code> files provide the best loading and playback performance since they do not need to be decompressed. For music, <code>.mp3</code> or <code>.ogg</code> files are better choices as they reduce file size while maintaining good quality.</p>
</div>
<h3 id="adding-audio-files">Adding Audio Files</h3>
<p>Adding audio files can be done through the content pipeline, just like we did for image files, using the MGCB Editor.  When you add an audio file to the content project, the MGCB Editor will automatically select the appropriate importer and processor for the audio file based on the file extension.</p>
<p>The processor that are available for audio files file:</p>
<ul>
<li><strong>Sound Effects</strong>: Processes the audio file as a <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect"><strong>SoundEffect</strong></a>.  This is  automatically selected for <em>.wav</em> files.</li>
<li><strong>Song</strong>: Processes the audio file as a <a href="xref:Microsoft.Xna.Framework.Media.Song"><strong>Song</strong></a>.  This is automatically selected for <em>.mp3</em>, <em>.ogg</em>, and <em>.wma</em> files.</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: center;"><img src="./images/sound-effect-properties.png" alt="Figure 14-2: MGCB Editor properties panel showing Sound Effect content processor settings for .wav files"></th>
<th style="text-align: center;"><img src="./images/song-properties.png" alt="Figure 14-3: MGCB Editor properties panel showing Song content processor settings for .mp3 files"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>Figure 14-2: MGCB Editor properties panel showing Sound Effect content processor settings for .wav files</strong></td>
<td style="text-align: center;"><strong>Figure 14-3: MGCB Editor properties panel showing Song content processor settings for .mp3 files</strong></td>
</tr>
</tbody>
</table>
<div class="NOTE">
<h5>Note</h5>
<p>While you typically will not need to change the processor it automatically selects, there may be times where you add files, such as <em>.mp3</em> files that are meant to be sound effects and not songs.  Always double check that the processor selected is for the intended type.</p>
</div>
<h3 id="loading-sound-effects">Loading Sound Effects</h3>
<p>To load a sound effect, we use <a href="xref:Microsoft.Xna.Framework.Content.ContentManager.Load%60%601(System.String)"><strong>ContentManager.Load</strong></a> with the <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect"><strong>SoundEffect</strong></a> type:</p>
<pre><code class="lang-csharp">// Loading a SoundEffect using the content pipeline
SoundEffect soundEffect = Content.Load&lt;SoundEffect&gt;(&quot;soundEffect&quot;);
</code></pre><h3 id="loading-music">Loading Music</h3>
<p>Loading music is similar, only we specify the <a href="xref:Microsoft.Xna.Framework.Media.Song"><strong>Song</strong></a> type instead.</p>
<pre><code class="lang-csharp">// Loading a Song using the content pipeline
Song song = Content.Load&lt;Song&gt;(&quot;song&quot;);
</code></pre><h2 id="playing-sound-effects">Playing Sound Effects</h2>
<p>Sound effects are played using the <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect"><strong>SoundEffect</strong></a> class. This class provides two ways to play sounds:</p>
<ol>
<li><p>Direct playback using <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect.Play"><strong>SoundEffect.Play</strong></a>:</p>
<pre><code class="lang-csharp">// Loading a SoundEffect using the content pipeline
SoundEffect soundEffect = Content.Load&lt;SoundEffect&gt;(&quot;soundEffect&quot;);

// Play the sound effect with default settings
soundEffect.Play();
</code></pre></li>
<li><p>Creating an instance using <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect.CreateInstance"><strong>SoundEffect.CreateInstance</strong></a>:</p>
<pre><code class="lang-csharp">// Loading a SoundEffect using the content pipeline
SoundEffect soundEffect = Content.Load&lt;SoundEffect&gt;(&quot;soundEffect&quot;);

// Create an instance we can control
SoundEffectInstance soundEffectInstance = soundEffect.CreateInstance();

// Adjust the properties of the instance as needed
soundEffectInstance.IsLooped = true;    // Make it loop
soundEffectInstance.Volume = 0.5f;      // Set half volume.

// Play the sound effect using the instance.
soundEffectInstance.Play();
</code></pre></li>
</ol>
<ul>
<li>Use <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect.Play"><strong>SoundEffect.Play</strong></a> for simple sound effects that you just want to play once.</li>
<li>Use <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect.CreateInstance"><strong>SoundEffect.CreateInstance</strong></a> when you need more control over the sound effect, like adjusting volume, looping, or managing multiple instances of the same sound.</li>
</ul>
<p><a href="xref:Microsoft.Xna.Framework.Audio.SoundEffectInstance"><strong>SoundEffectInstance</strong></a> contains several properties that can be used to control how the sound effect is played:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="xref:Microsoft.Xna.Framework.Audio.SoundEffectInstance.IsLooped"><strong>IsLooped</strong></a></td>
<td><code>bool</code></td>
<td>Whether the sound should loop when it reaches the end.</td>
</tr>
<tr>
<td><a href="xref:Microsoft.Xna.Framework.Audio.SoundEffectInstance.Pan"><strong>Pan</strong></a></td>
<td><code>float</code></td>
<td>Stereo panning between -1.0f (full left) and 1.0f (full right).</td>
</tr>
<tr>
<td><a href="xref:Microsoft.Xna.Framework.Audio.SoundEffectInstance.Pitch"><strong>Pitch</strong></a></td>
<td><code>float</code></td>
<td>Pitch adjustment between -1.0f (down one octave) and 1.0f (up one octave).</td>
</tr>
<tr>
<td><a href="xref:Microsoft.Xna.Framework.Audio.SoundEffectInstance.State"><strong>State</strong></a></td>
<td><a href="xref:Microsoft.Xna.Framework.Audio.SoundState"><strong>SoundState</strong></a></td>
<td>Current playback state (Playing, Paused, or Stopped).</td>
</tr>
<tr>
<td><a href="xref:Microsoft.Xna.Framework.Audio.SoundEffectInstance.Volume"><strong>Volume</strong></a></td>
<td><code>float</code></td>
<td>Volume level between 0.0f (silent) and 1.0f (full volume).</td>
</tr>
</tbody>
</table>
<div class="NOTE">
<h5>Note</h5>
<p>There is a lot more behind SoundEffectInstances such as the ability to play 3D sounds, as well as the advanced capabilities of the <a href="xref:Microsoft.Xna.Framework.Audio.DynamicSoundEffectInstance">DynamicSoundEffectInstance</a> which can build audio streams.  However, these are beyond the scope of this beginners guide.  If you wish to know more, then check the <a href="/articles/getting_to_know/whatis/audio/">MonoGame documentation</a></p>
</div>
<h2 id="playing-music">Playing Music</h2>
<p>Unlike sound effects, music is played through the <a href="xref:Microsoft.Xna.Framework.Media.MediaPlayer"><strong>MediaPlayer</strong></a> class. This static class manages playback of <a href="xref:Microsoft.Xna.Framework.Media.Song"><strong>Song</strong></a> instances and provides global control over music playback:</p>
<pre><code class="lang-csharp">// Loading a Song using the content pipeline
Song song = Content.Load&lt;Song&gt;(&quot;song&quot;);

// Set whether the song should repeat when finished
MediaPlayer.IsRepeating = true;

// Adjust the volume (0.0f to 1.0f)
MediaPlayer.Volume = 0.5f;

// Check if the media player is already playing, if so, stop it
if(MediaPlayer.State == MediaState.Playing)
{
    MediaPlayer.Stop();
}

// Start playing the background music
MediaPlayer.Play(song);
</code></pre>
<div class="IMPORTANT">
<h5>Important</h5>
<p>While <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect"><strong>SoundEffect</strong></a> instances can be played simultaneously, trying to play a new <a href="xref:Microsoft.Xna.Framework.Media.Song"><strong>Song</strong></a> while another is playing will stop the current song in the best case, and in the worst case cause a crash on some platforms.  In the example above, the state of the media player is checked first before we tell it to play a song.  Checking the state first and stopping it manually if it is playing is best practice to prevent potential crashes.</p>
</div>
<h2 id="adding-audio-to-our-game">Adding Audio To Our Game</h2>
<p>Before we can add audio to our game, we need some sound files to work with. Download the following audio files:</p>
<ul>
<li><a href="./files/bounce.wav">bounce.wav</a>{download} - For when the bat bounces off screen edges</li>
<li><a href="./files/collect.wav">collect.wav</a>{download} - For when the slime eats the bat</li>
<li><a href="./files/theme.ogg">theme.ogg</a>{download} - Background music</li>
</ul>
<div class="NOTE">
<h5>Note</h5>
<ul>
<li><em>bounce.wav</em> is &quot;Retro Impact Punch 07&quot; by Davit Masia (<a href="https://kronbits.itch.io/retrosfx">https://kronbits.itch.io/retrosfx</a>).</li>
<li><em>collect.wav</em> is &quot;Retro Jump Classic 08&quot; by Davit Masia (<a href="https://kronbits.itch.io/retrosfx">https://kronbits.itch.io/retrosfx</a>).</li>
<li><em>theme.mp3</em> is &quot;Exploration&quot; by Luis Zuno (<a href="https://twitter.com/ansimuz">@ansimuz</a>).</li>
</ul>
</div>
<p>Add these files to your content project using the MGCB Editor:</p>
<ol>
<li>Open the <em>Content.mgcb</em> file in the MGCB Editor.</li>
<li>Create a new folder called <code>audio</code> (right-click <em>Content</em> &gt; <em>Add</em> &gt; <em>New Folder</em>).</li>
<li>Right-click the new <em>audio</em> folder and choose <em>Add</em> &gt; <em>Existing Item...</em>.</li>
<li>Navigate to and select the audio files you downloaded.</li>
<li>For each file that is added, check its properties in the Properties panel:
<ul>
<li>For <code>.wav</code> files, ensure the <em>Processor</em> is set to <code>Sound Effect</code>.</li>
<li>For <code>.mp3</code> files, ensure the <em>Processor</em> is set to <code>Song</code>.</li>
</ul>
</li>
<li>Save the changes and close the MGCB Editor.</li>
</ol>
<p>Next, open the <code>Game1.cs</code> file and update it to the following:</p>
<pre><code class="lang-csharp" highlight-lines="3,6,39-43,92-111,201-202,220-221">using System;
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Audio;
using Microsoft.Xna.Framework.Graphics;
using Microsoft.Xna.Framework.Input;
using Microsoft.Xna.Framework.Media;
using MonoGameLibrary;
using MonoGameLibrary.Graphics;
using MonoGameLibrary.Input;

namespace DungeonSlime;

public class Game1 : Core
{
    // Defines the slime animated sprite.
    private AnimatedSprite _slime;

    // Defines the bat animated sprite.
    private AnimatedSprite _bat;

    // Tracks the position of the slime.
    private Vector2 _slimePosition;

    // Speed multiplier when moving.
    private const float MOVEMENT_SPEED = 5.0f;

    // Tracks the position of the bat.
    private Vector2 _batPosition;

    // Tracks the velocity of the bat.
    private Vector2 _batVelocity;

    // Defines the tilemap to draw.
    private Tilemap _tilemap;

    // Defines the bounds of the room that the slime and bat are contained within.
    private Rectangle _roomBounds;

    // The sound effect to play when the bat bounces off the edge of the screen.
    private SoundEffect _bounceSoundEffect;

    // The sound effect to play when the slime eats a bat.
    private SoundEffect _collectSoundEffect;

    public Game1() : base(&quot;Dungeon Slime&quot;, 1280, 720, false)
    {

    }

    protected override void Initialize()
    {
        base.Initialize();

        Rectangle screenBounds = GraphicsDevice.PresentationParameters.Bounds;

        _roomBounds = new Rectangle(
            (int)_tilemap.TileWidth,
            (int)_tilemap.TileHeight,
            screenBounds.Width - (int)_tilemap.TileWidth * 2,
            screenBounds.Height - (int)_tilemap.TileHeight * 2
        );

        // Initial slime position will be the center tile of the tile map.
        int centerRow = _tilemap.Rows / 2;
        int centerColumn = _tilemap.Columns / 2;
        _slimePosition = new Vector2(centerColumn * _tilemap.TileWidth, centerRow * _tilemap.TileHeight);

        // Initial bat position will the in the top left corner of the room
        _batPosition = new Vector2(_roomBounds.Left, _roomBounds.Top);

        // Assign the initial random velocity to the bat.
        AssignRandomBatVelocity();
    }

    protected override void LoadContent()
    {
        // Create the texture atlas from the XML configuration file
        TextureAtlas atlas = TextureAtlas.FromFile(Content, &quot;images/atlas-definition.xml&quot;);

        // Create the slime animated sprite from the atlas.
        _slime = atlas.CreateAnimatedSprite(&quot;slime-animation&quot;);
        _slime.Scale = new Vector2(4.0f, 4.0f);

        // Create the bat animated sprite from the atlas.
        _bat = atlas.CreateAnimatedSprite(&quot;bat-animation&quot;);
        _bat.Scale = new Vector2(4.0f, 4.0f);

        // Create the tilemap from the XML configuration file.
        _tilemap = Tilemap.FromFile(Content, &quot;images/tilemap-definition.xml&quot;);
        _tilemap.Scale = new Vector2(4.0f, 4.0f);

        // Load the bounce sound effect
        _bounceSoundEffect = Content.Load&lt;SoundEffect&gt;(&quot;audio/bounce&quot;);

        // Load the collect sound effect
        _collectSoundEffect = Content.Load&lt;SoundEffect&gt;(&quot;audio/collect&quot;);

        // Load the background theme music
        Song theme = Content.Load&lt;Song&gt;(&quot;audio/theme&quot;);

        // Ensure media player is not already playing on device, if so, stop it
        if (MediaPlayer.State == MediaState.Playing)
        {
            MediaPlayer.Stop();
        }

        // Play the background theme music.
        MediaPlayer.Play(theme);

        // Set the theme music to repeat.
        MediaPlayer.IsRepeating = true;
    }

    protected override void Update(GameTime gameTime)
    {
        // Update the slime animated sprite.
        _slime.Update(gameTime);

        // Update the bat animated sprite.
        _bat.Update(gameTime);

        // Check for keyboard input and handle it.
        CheckKeyboardInput();

        // Check for gamepad input and handle it.
        CheckGamePadInput();

        // Creating a bounding circle for the slime
        Circle slimeBounds = new Circle(
            (int)(_slimePosition.X + (_slime.Width * 0.5f)),
            (int)(_slimePosition.Y + (_slime.Height * 0.5f)),
            (int)(_slime.Width * 0.5f)
        );

        // Use distance based checks to determine if the slime is within the
        // bounds of the game screen, and if it is outside that screen edge,
        // move it back inside.
        if (slimeBounds.Left &lt; _roomBounds.Left)
        {
            _slimePosition.X = _roomBounds.Left;
        }
        else if (slimeBounds.Right &gt; _roomBounds.Right)
        {
            _slimePosition.X = _roomBounds.Right - _slime.Width;
        }

        if (slimeBounds.Top &lt; _roomBounds.Top)
        {
            _slimePosition.Y = _roomBounds.Top;
        }
        else if (slimeBounds.Bottom &gt; _roomBounds.Bottom)
        {
            _slimePosition.Y = _roomBounds.Bottom - _slime.Height;
        }

        // Calculate the new position of the bat based on the velocity
        Vector2 newBatPosition = _batPosition + _batVelocity;

        // Create a bounding circle for the bat
        Circle batBounds = new Circle(
            (int)(newBatPosition.X + (_bat.Width * 0.5f)),
            (int)(newBatPosition.Y + (_bat.Height * 0.5f)),
            (int)(_bat.Width * 0.5f)
        );

        Vector2 normal = Vector2.Zero;

        // Use distance based checks to determine if the bat is within the
        // bounds of the game screen, and if it is outside that screen edge,
        // reflect it about the screen edge normal
        if (batBounds.Left &lt; _roomBounds.Left)
        {
            normal.X = Vector2.UnitX.X;
            newBatPosition.X = _roomBounds.Left;
        }
        else if (batBounds.Right &gt; _roomBounds.Right)
        {
            normal.X = -Vector2.UnitX.X;
            newBatPosition.X = _roomBounds.Right - _bat.Width;
        }

        if (batBounds.Top &lt; _roomBounds.Top)
        {
            normal.Y = Vector2.UnitY.Y;
            newBatPosition.Y = _roomBounds.Top;
        }
        else if (batBounds.Bottom &gt; _roomBounds.Bottom)
        {
            normal.Y = -Vector2.UnitY.Y;
            newBatPosition.Y = _roomBounds.Bottom - _bat.Height;
        }

        // If the normal is anything but Vector2.Zero, this means the bat had
        // moved outside the screen edge so we should reflect it about the
        // normal.
        if (normal != Vector2.Zero)
        {
            normal.Normalize();
            _batVelocity = Vector2.Reflect(_batVelocity, normal);

            // Play the bounce sound effect
            _bounceSoundEffect.Play();
        }

        _batPosition = newBatPosition;

        if (slimeBounds.Intersects(batBounds))
        {
            // Choose a random row and column based on the total number of each
            int column = Random.Shared.Next(1, _tilemap.Columns - 1);
            int row = Random.Shared.Next(1, _tilemap.Rows - 1);

            // Change the bat position by setting the x and y values equal to
            // the column and row multiplied by the width and height.
            _batPosition = new Vector2(column * _bat.Width, row * _bat.Height);

            // Assign a new random velocity to the bat
            AssignRandomBatVelocity();

            // Play the collect sound effect
            _collectSoundEffect.Play();
        }

        base.Update(gameTime);
    }

    private void AssignRandomBatVelocity()
    {
        // Generate a random angle
        float angle = (float)(Random.Shared.NextDouble() * Math.PI * 2);

        // Convert angle to a direction vector
        float x = (float)Math.Cos(angle);
        float y = (float)Math.Sin(angle);
        Vector2 direction = new Vector2(x, y);

        // Multiply the direction vector by the movement speed
        _batVelocity = direction * MOVEMENT_SPEED;
    }

    private void CheckKeyboardInput()
    {
        // If the space key is held down, the movement speed increases by 1.5
        float speed = MOVEMENT_SPEED;
        if (Input.Keyboard.IsKeyDown(Keys.Space))
        {
            speed *= 1.5f;
        }

        // If the W or Up keys are down, move the slime up on the screen.
        if (Input.Keyboard.IsKeyDown(Keys.W) || Input.Keyboard.IsKeyDown(Keys.Up))
        {
            _slimePosition.Y -= speed;
        }

        // if the S or Down keys are down, move the slime down on the screen.
        if (Input.Keyboard.IsKeyDown(Keys.S) || Input.Keyboard.IsKeyDown(Keys.Down))
        {
            _slimePosition.Y += speed;
        }

        // If the A or Left keys are down, move the slime left on the screen.
        if (Input.Keyboard.IsKeyDown(Keys.A) || Input.Keyboard.IsKeyDown(Keys.Left))
        {
            _slimePosition.X -= speed;
        }

        // If the D or Right keys are down, move the slime right on the screen.
        if (Input.Keyboard.IsKeyDown(Keys.D) || Input.Keyboard.IsKeyDown(Keys.Right))
        {
            _slimePosition.X += speed;
        }
    }

    private void CheckGamePadInput()
    {
        GamePadInfo gamePadOne = Input.GamePads[(int)PlayerIndex.One];

        // If the A button is held down, the movement speed increases by 1.5
        // and the gamepad vibrates as feedback to the player.
        float speed = MOVEMENT_SPEED;
        if (gamePadOne.IsButtonDown(Buttons.A))
        {
            speed *= 1.5f;
            GamePad.SetVibration(PlayerIndex.One, 1.0f, 1.0f);
        }
        else
        {
            GamePad.SetVibration(PlayerIndex.One, 0.0f, 0.0f);
        }

        // Check thumbstick first since it has priority over which gamepad input
        // is movement.  It has priority since the thumbstick values provide a
        // more granular analog value that can be used for movement.
        if (gamePadOne.LeftThumbStick != Vector2.Zero)
        {
            _slimePosition.X += gamePadOne.LeftThumbStick.X * speed;
            _slimePosition.Y -= gamePadOne.LeftThumbStick.Y * speed;
        }
        else
        {
            // If DPadUp is down, move the slime up on the screen.
            if (gamePadOne.IsButtonDown(Buttons.DPadUp))
            {
                _slimePosition.Y -= speed;
            }

            // If DPadDown is down, move the slime down on the screen.
            if (gamePadOne.IsButtonDown(Buttons.DPadDown))
            {
                _slimePosition.Y += speed;
            }

            // If DPapLeft is down, move the slime left on the screen.
            if (gamePadOne.IsButtonDown(Buttons.DPadLeft))
            {
                _slimePosition.X -= speed;
            }

            // If DPadRight is down, move the slime right on the screen.
            if (gamePadOne.IsButtonDown(Buttons.DPadRight))
            {
                _slimePosition.X += speed;
            }
        }
    }

    protected override void Draw(GameTime gameTime)
    {
        // Clear the back buffer.
        GraphicsDevice.Clear(Color.CornflowerBlue);

        // Begin the sprite batch to prepare for rendering.
        SpriteBatch.Begin(samplerState: SamplerState.PointClamp);

        // Draw the tilemap
        _tilemap.Draw(SpriteBatch);

        // Draw the slime sprite.
        _slime.Draw(SpriteBatch, _slimePosition);

        // Draw the bat sprite.
        _bat.Draw(SpriteBatch, _batPosition);

        // Always end the sprite batch when finished.
        SpriteBatch.End();

        base.Draw(gameTime);
    }
}
</code></pre>
<p>The key changes here are:</p>
<ol>
<li>Added the <code>using Microsoft.Xna.Framework.Audio;</code> and <code>using Microsoft.Xna.Framework.Media;</code> directories to access the <a href="xref:Microsoft.Xna.Framework.Media.Song"><strong>Song</strong></a> and <a href="xref:Microsoft.Xna.Framework.Audio"><strong>SoundEffect</strong></a> classes.</li>
<li>Added the <code>_boundSoundEffect</code> and <code>_collectSoundEffect</code> fields to store those sound effects when loaded and use them for playback.</li>
<li>In <a href="xref:Microsoft.Xna.Framework.Game.LoadContent"><strong>LoadContent</strong></a>
<ol>
<li>The bounce and collect sound effects are loaded using the content manager.</li>
<li>The background theme music is loaded using the content manager.</li>
<li>The background music is played using the media player, checking its state first.</li>
<li>The <a href="xref:Microsoft.Xna.Framework.Media.MediaPlayer.IsRepeating"><strong>MediaPlayer.IsRepeating</strong></a> is set to <code>true</code> so the background music loops.</li>
</ol>
</li>
<li>In <a href="xref:Microsoft.Xna.Framework.Game.Update(Microsoft.Xna.Framework.GameTime)"><strong>Update</strong></a>:
<ol>
<li>The bounce sound effect is played when the bat bounces off the edge of the screen.</li>
<li>The collect sound effect is played when the slime eats the bat.</li>
</ol>
</li>
</ol>
<p>Running the game now, the theme music plays in the background, you can hear the bat bounce off the edge of the screen, and if you move the slime to eat the bat, you hear that as well.</p>
<table>
<thead>
<tr>
<th style="text-align: center;"><video width="500" height="281" controls=""><source type="video/webm" src="./videos/gameplay.webm"></video></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>Figure 14-4: Gameplay with audio.</strong></td>
</tr>
</tbody>
</table>
<h2 id="conclusion">Conclusion</h2>
<p>In this chapter, you accomplished the following:</p>
<ul>
<li>Learned about MonoGame's audio system including sound effects and music.</li>
<li>Explored the key differences between:
<ul>
<li>Sound effects (short, multiple simultaneous playback).</li>
<li>Music (longer, streamed, single playback).</li>
</ul>
</li>
<li>Added audio content to your game project through the content pipeline.</li>
<li>Loaded audio files using the ContentManager.</li>
<li>Implemented audio feedback in your game:
<ul>
<li>Background music to set atmosphere.</li>
<li>Sound effects for bat bouncing and collection events.</li>
</ul>
</li>
<li>Learned best practices for handling audio playback across different platforms.</li>
</ul>
<p>In the next chapter, we will explore additional ways to manage audio by creating an audio controller module that will help with common tasks such as volume control, muting, and state management.</p>
<h2 id="test-your-knowledge">Test Your Knowledge</h2>
<ol>
<li><p>What are the two main classes MonoGame provides for audio playback and how do they differ?</p>
<p>:::question-answer
MonoGame provides:</p>
<ul>
<li><a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect"><strong>SoundEffect</strong></a> for short audio clips (loaded entirely into memory, multiple can play at once) and</li>
<li><a href="xref:Microsoft.Xna.Framework.Media.Song"><strong>Song</strong></a> for longer audio like music (streamed from storage, only one can play at a time).</li>
</ul>
<p>:::</p>
</li>
<li><p>Why is it important to check if <a href="xref:Microsoft.Xna.Framework.Media.MediaPlayer"><strong>MediaPlayer</strong></a> is already playing before starting a new song?</p>
<p>:::question-answer
Checking if MediaPlayer is already playing and stopping it if necessary helps prevent crashes on some platforms. Since only one song can play at a time, properly stopping the current song before starting a new one ensures reliable behavior across different platforms.
:::</p>
</li>
<li><p>What file formats are best suited for sound effects and music, respectively, and why?</p>
<p>:::question-answer
For sound effects, .wav files are generally best because they are uncompressed and load quickly into memory for immediate playback. For music, compressed formats like .mp3 or .ogg are better suited because they greatly reduce file size while maintaining good audio quality, which is important for longer audio that's streamed rather than fully loaded.
:::</p>
</li>
<li><p>What is the difference between using <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect.Play"><strong>SoundEffect.Play</strong></a> directly and creating a <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffectInstance"><strong>SoundEffectInstance</strong></a>?</p>
<p>:::question-answer</p>
<ul>
<li><a href="xref:Microsoft.Xna.Framework.Audio.SoundEffect.Play"><strong>SoundEffect.Play</strong></a> is simpler but provides limited control - it plays the sound once with basic volume/pitch/pan settings.</li>
<li>Creating a <a href="xref:Microsoft.Xna.Framework.Audio.SoundEffectInstance"><strong>SoundEffectInstance</strong></a> gives more control including the ability to pause, resume, loop, and change properties during playback, as well as track the sound's state.</li>
</ul>
<p>:::</p>
</li>
<li><p>How many sound effects can play simultaneously on different platforms?</p>
<p>:::question-answer
The number of simultaneous sound effects varies by platform:</p>
<ul>
<li>Mobile platforms: maximum of 32 sounds.</li>
<li>Desktop platforms: maximum of 256 sounds.</li>
<li>Consoles and other platforms have their own constraints specified in their respective SDK documentation.
:::</li>
</ul>
</li>
</ol>

</article>
                </div>

            </main>
        </div>


        <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
        <script type="text/javascript" src="../../../../../../styles/jquery.twbsPagination.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/jquery.mark.min.js"></script>
        <script type="text/javascript" src="../../../../../../styles/url.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/anchor-js@5.0.0/anchor.min.js"></script>
        <script type="text/javascript" src="../../../../../../styles/docfx.js"></script>
        <script type="text/javascript" src="../../../../../../styles/main.js"></script>
        <script type="text/javascript" src="../../../../../../styles/singulink.js"></script>    </body>
</html>
