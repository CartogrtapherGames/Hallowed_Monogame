<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:viewModels="clr-namespace:Hallowed.Editor.ViewModels"
             xmlns:nodeVm="clr-namespace:Hallowed.Editor.ViewModels"
             xmlns:views="clr-namespace:Hallowed.Editor.Views"
             xmlns:views1="clr-namespace:Hallowed.Editor.Views"
             x:Class="Hallowed.Editor.Views.StoryEditorView"
             x:DataType="viewModels:StoryEditorViewModel">

    <Border Classes="ContentPanel">
        <Grid ColumnDefinitions="300,*" ColumnSpacing="15">

            <!-- Left: Story Tree -->
            <Border Grid.Column="0"
                    Background="{StaticResource ParchmentMedium}"
                    Padding="10"
                    CornerRadius="8">
                <Grid RowDefinitions="Auto,Auto,*,Auto">
                    <!-- Header -->
                    <TextBlock Grid.Row="0"
                               Text="📖 Stories"
                               Classes="SectionHeader"
                               FontSize="18" />

                    <Separator Grid.Row="1" Margin="0,10" />

                    <!-- TreeView -->
                    <TreeView Grid.Row="2"
                              ItemsSource="{Binding Items}"
                              SelectedItem="{Binding SelectedItem}"
                              AutoScrollToSelectedItem="True">
                        <TreeView.DataTemplates>
                            <TreeDataTemplate DataType="viewModels:TreeItemViewModel" 
                                              ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Horizontal" Spacing="5">
                                    <TextBlock Text="📁"
                                               FontSize="16"
                                               IsVisible="{Binding IsFolder}" />
                                    <TextBlock Text="📄"
                                               FontSize="16"
                                               IsVisible="{Binding !IsFolder}" />
                                    <TextBlock Text="{Binding Name}" />
                                </StackPanel>
                            </TreeDataTemplate>
                        </TreeView.DataTemplates>
                    </TreeView>

                    <!-- Buttons -->
                    <StackPanel Grid.Row="3" Spacing="5" Margin="0,10,0,0">
                        <Button Content="📁 New Folder"
                                Command="{Binding AddFolderCommand}"
                                Classes="SecondaryButton"
                                HorizontalAlignment="Stretch" />
                        <Button Content="📄 New Node"
                                Command="{Binding AddStoryCommand}"
                                Classes="PrimaryButton"
                                HorizontalAlignment="Stretch" />
                        <Button Content="🗑️ Delete"
                                Command="{Binding DeleteStoryCommand}"
                                Classes="SecondaryButton"
                                HorizontalAlignment="Stretch"
                                IsEnabled="{Binding SelectedItem.Node, Converter={x:Static ObjectConverters.IsNotNull}}" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Right: Node Editor -->
            <Border Grid.Column="1"
                    Background="{StaticResource ParchmentMedium}"
                    Padding="20"
                    CornerRadius="8">
                
                <Grid>
                    <!-- Placeholder when no node selected -->
                    <StackPanel HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Spacing="10"
                                IsVisible="{Binding CurrentNodeEditor, Converter={x:Static ObjectConverters.IsNull}}">
                        <TextBlock Text="📄"
                                   FontSize="48"
                                   HorizontalAlignment="Center"
                                   Opacity="0.3" />
                        <TextBlock Text="Select a node to edit"
                                   Classes="Subtitle"
                                   HorizontalAlignment="Center"
                                   Opacity="0.6" />
                    </StackPanel>
                    
                    <!-- Editor when node is selected -->
                    <ContentControl Content="{Binding CurrentNodeEditor}"
                                    IsVisible="{Binding CurrentNodeEditor, Converter={x:Static ObjectConverters.IsNotNull}}">
                        <ContentControl.DataTemplates>
                            <!-- Linear Node Editor -->
                            <DataTemplate DataType="viewModels:NodeLinearViewModel">
                                <views1:NodeLinearEditorView />
                            </DataTemplate>
                            
                            <!-- Future: Add more node type editors here -->
                            <!-- <DataTemplate DataType="nodeVm:NodeChoiceViewModel">
                                <views:NodeChoiceEditorView />
                            </DataTemplate> -->
                        </ContentControl.DataTemplates>
                    </ContentControl>
                </Grid>
                
            </Border>

        </Grid>
    </Border>
</UserControl>